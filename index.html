<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Quiz with ARASAAC</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    #question-container, #options-container, #response-container, #next-button {
      margin-top: 20px;
    }
    .option {
      display: inline-block;
      margin: 10px;
      text-align: center;
      cursor: pointer;
    }
    .option img {
      width: 100px;
      height: 100px;
      object-fit: contain;
    }
    .option span {
      display: block;
      margin-top: 5px;
    }
    #feedback {
      margin-top: 20px;
      font-size: 1.2em;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Welcome to the Quiz</h1>
  <div id="question-container"></div>
  <div id="options-container"></div>
  <div id="response-container"></div>
  <button id="next-button" disabled>Next</button>
  <div id="feedback"></div>

  <script>
    const questions = [
      {
        type: 'input',
        text: 'What is your name?'
      },
      {
        type: 'choice',
        text: 'What is your favourite colour?',
        options: ['red', 'blue', 'green', 'yellow', 'purple', 'orange']
      },
      {
        type: 'choice',
        text: 'What do you like to do?',
        options: ['draw', 'read', 'run', 'swim', 'play', 'sing']
      },
      {
        type: 'choice',
        text: 'What is your favourite animal?',
        options: ['dog', 'cat', 'rabbit', 'horse', 'bird', 'fish']
      }
    ];

    let currentQuestion = 0;
    let studentName = '';
    const questionContainer = document.getElementById('question-container');
    const optionsContainer = document.getElementById('options-container');
    const responseContainer = document.getElementById('response-container');
    const nextButton = document.getElementById('next-button');
    const feedback = document.getElementById('feedback');

    function loadQuestion() {
      const q = questions[currentQuestion];
      questionContainer.textContent = q.text;
      optionsContainer.innerHTML = '';
      responseContainer.innerHTML = '';
      feedback.textContent = '';
      nextButton.disabled = true;

      if (q.type === 'input') {
        const input = document.createElement('input');
        input.type = 'text';
        input.placeholder = 'Type your answer here';
        input.addEventListener('input', () => {
          nextButton.disabled = input.value.trim() === '';
        });
        responseContainer.appendChild(input);
      } else if (q.type === 'choice') {
        q.options.forEach(option => {
          const div = document.createElement('div');
          div.className = 'option';

          // Fetch ARASAAC pictogram for the word
          fetch(`https://api.arasaac.org/api/pictograms/en/search/${option}`)
            .then(res => res.json())
            .then(data => {
              const pictogram = data[0];
              const img = document.createElement('img');
              img.src = `https://static.arasaac.org/pictograms/${pictogram._id}/${pictogram._id}_500.png`;
              div.appendChild(img);
            })
            .catch(() => {
              const fallback = document.createElement('div');
              fallback.textContent = '?';
              fallback.style.fontSize = '40px';
              div.appendChild(fallback);
            });

          const label = document.createElement('span');
          label.textContent = option;
          div.appendChild(label);

          div.addEventListener('click', () => {
            feedback.textContent = `Great ${studentName}! ${q.text.replace('What is your', 'Your').toLowerCase()} is ${option}.`;
            nextButton.disabled = false;
          });

          optionsContainer.appendChild(div);
        });
      }
    }

    nextButton.addEventListener('click', () => {
      const q = questions[currentQuestion];

      if (q.type === 'input') {
        const inputVal = responseContainer.querySelector('input').value.trim();
        if (inputVal !== '') {
          studentName = inputVal;
          feedback.textContent = `Hello ${studentName}! Well done. Now… ${questions[currentQuestion + 1].text}`;
        }
      }

      currentQuestion++;
      if (currentQuestion < questions.length) {
        setTimeout(loadQuestion, 1000);
      } else {
        questionContainer.textContent = `Thank you, ${studentName}! You’ve finished the quiz.`;
        optionsContainer.innerHTML = '';
        responseContainer.innerHTML = '';
        feedback.textContent = '';
        nextButton.style.display = 'none';
      }
    });

    loadQuestion();
  </script>
</body>
</html>
