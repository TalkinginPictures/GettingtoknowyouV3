<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Meet & Greet Quiz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 1rem;
      background-color: #f0f8ff;
    }
    h2 {
      color: #333;
    }
    .question {
      margin-top: 2rem;
    }
    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .option {
      border: 2px solid #ccc;
      padding: 10px;
      border-radius: 10px;
      cursor: pointer;
      text-align: center;
      width: 120px;
    }
    .option.selected {
      border-color: #007BFF;
      background-color: #e0f0ff;
    }
    button {
      margin-top: 1rem;
      padding: 10px 20px;
      font-size: 1rem;
    }
    #summary {
      white-space: pre-wrap;
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <h2 id="header">Welcome to the Quiz</h2>
  <div class="question" id="question-container">
    <p id="question"></p>
    <div id="input-container"></div>
    <div class="options" id="options-container"></div>
    <button id="next-btn" disabled>Next</button>
  </div>
  <div id="summary" style="display: none;"></div>
  <button id="print-btn" style="display: none;">Print Answers</button>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "YOUR_FIREBASE_API_KEY",
      authDomain: "YOUR_FIREBASE_AUTH_DOMAIN",
      projectId: "YOUR_FIREBASE_PROJECT_ID",
      storageBucket: "YOUR_FIREBASE_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const questions = [
      {
        type: "input",
        text: "What is your name?",
        key: "name"
      },
      {
        text: "What is your favourite colour?",
        key: "color",
        options: ["red", "blue", "green", "yellow", "purple", "orange"]
      },
      {
        text: "What food do you like?",
        key: "food",
        options: ["pizza", "pasta", "burger", "rice", "chicken", "fish"]
      },
      {
        text: "What do you like to do?",
        key: "activity",
        options: ["drawing", "reading", "gaming", "dancing", "football", "singing"]
      },
      {
        text: "Who do you like to spend time with?",
        key: "people",
        options: ["mum", "dad", "brother", "sister", "friend", "teacher"]
      },
      {
        text: "How do you feel today?",
        key: "feeling",
        options: ["happy", "sad", "tired", "excited", "nervous", "calm"]
      }
    ];

    let currentIndex = 0;
    const responses = {};
    const questionEl = document.getElementById("question");
    const inputContainer = document.getElementById("input-container");
    const optionsContainer = document.getElementById("options-container");
    const nextBtn = document.getElementById("next-btn");
    const summaryEl = document.getElementById("summary");
    const header = document.getElementById("header");
    const printBtn = document.getElementById("print-btn");

    function renderQuestion() {
      const q = questions[currentIndex];
      questionEl.textContent = q.text;
      inputContainer.innerHTML = "";
      optionsContainer.innerHTML = "";
      nextBtn.disabled = true;

      if (q.type === "input") {
        const input = document.createElement("input");
        input.type = "text";
        input.placeholder = "Type your answer here";
        inputContainer.appendChild(input);
        input.addEventListener("input", () => {
          nextBtn.disabled = input.value.trim() === "";
        });
      } else {
        q.options.forEach(option => {
          const div = document.createElement("div");
          div.className = "option";
          div.innerHTML = `<img src="https://api.arasaac.org/api/pictograms/${option}?size=100" onerror="this.style.display='none'" /><br>${option}`;
          div.addEventListener("click", () => {
            document.querySelectorAll(".option").forEach(opt => opt.classList.remove("selected"));
            div.classList.add("selected");
            nextBtn.disabled = false;
            responses[q.key] = option;
          });
          optionsContainer.appendChild(div);
        });
      }
    }

    nextBtn.addEventListener("click", async () => {
      const q = questions[currentIndex];

      if (q.type === "input") {
        const input = inputContainer.querySelector("input");
        responses[q.key] = input.value.trim();
        header.textContent = `Hello ${responses.name}! Let's begin.`;
      } else {
        const selected = document.querySelector(".option.selected");
        if (selected) {
          header.textContent = `Great ${responses.name}, your ${q.key} is ${responses[q.key]}.`;
        }
      }

      currentIndex++;
      if (currentIndex < questions.length) {
        renderQuestion();
      } else {
        // Show summary
        const summary = `Well done, ${responses.name}!\n\n` +
          `Your favourite colour is ${responses.color}.\n` +
          `You like to eat ${responses.food}.\n` +
          `You enjoy ${responses.activity}.\n` +
          `You like spending time with ${responses.people}.\n` +
          `You feel ${responses.feeling} today.\n\nThanks for sharing!`;

        summaryEl.textContent = summary;
        summaryEl.style.display = "block";
        printBtn.style.display = "inline-block";
        document.getElementById("question-container").style.display = "none";

        try {
          await addDoc(collection(db, "studentResponses"), {
            ...responses,
            timestamp: serverTimestamp()
          });
        } catch (e) {
          console.error("Error saving to Firebase:", e);
        }
      }
    });

    printBtn.addEventListener("click", () => {
      window.print();
    });

    renderQuestion();
  </script>
</body>
</html>
